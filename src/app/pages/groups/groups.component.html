<div class="groups-container">
  <h2>Groups</h2>

  <!-- ‚úÖ Create New Group -->
  <div *ngIf="canManage()" class="create-group">
    <input [(ngModel)]="name" placeholder="New group name" />
    <button (click)="create()">Create</button>
  </div>

  <!-- ‚úÖ Group List -->
  <select [(ngModel)]="selectedId">
    <option *ngFor="let g of list" [value]="g._id!">{{ g.name }}</option>
  </select>

  <button *ngIf="selectedId && canManage()" (click)="addChannel()">Add Channel</button>
  <input *ngIf="selectedId && canManage()" [(ngModel)]="channel" placeholder="New channel name" />

  <ul>
    <li *ngFor="let g of list">
      <h3>{{ g.name }}</h3>
      <p>Owner: {{ g.ownerUsername }}</p>

      <!-- ‚úÖ Channels -->
      <div *ngIf="g.channels.length">
        <b>Channels:</b>
        <ul>
          <li *ngFor="let ch of g.channels">
            {{ ch }}
            <button *ngIf="canManageGroup(g)" (click)="removeChannel(g, ch)">üóëÔ∏è</button>
          </li>
        </ul>
      </div>

      <!-- ‚úÖ Members -->
      <div *ngIf="g.members.length">
        <b>Members:</b>
        <ul>
          <li *ngFor="let m of g.members">{{ m }}</li>
        </ul>
      </div>

      <!-- ‚úÖ Join / Leave / Delete -->
      <div>
        <button *ngIf="!isMember(g) && !hasRequested(g)" (click)="request(g._id!)">Join</button>
        <button *ngIf="hasRequested(g)" disabled>Requested</button>
        <button *ngIf="isMember(g)" (click)="leave(g._id!)">Leave</button>
        <button *ngIf="canManageGroup(g)" (click)="remove(g._id!)">Delete</button>
        <button *ngIf="isMember(g)" (click)="openGroup(g)">Open Chat</button>
      </div>
    </li>
  </ul>

  <!-- ‚úÖ Active Group Chat -->
  <div *ngIf="activeGroup">
    <h2>{{ activeGroup.name }} ‚Äî Chat</h2>

    <div>
      <label>Channel:</label>
      <select [(ngModel)]="activeChannel">
        <option *ngFor="let ch of activeGroup.channels" [value]="ch">{{ ch }}</option>
      </select>
    </div>

    <app-chat
      [groupId]="activeGroup._id || ''"
      [channel]="activeChannel || ''"
    ></app-chat>

    <!-- ‚úÖ Join Requests Section -->
    <div *ngIf="canManageGroup(activeGroup)">
      <h3>Join Requests</h3>
      <ul>
        <li *ngFor="let r of activeGroup.joinRequests">
          {{ r }}
          <button (click)="approveJoin(activeGroup._id!, r)">Approve</button>
          <button (click)="rejectJoinRequest(activeGroup._id!, r)">Reject</button>
        </li>
      </ul>
    </div>
  </div>
</div>
